<Page x:Class="WpfApp1.Pages.AdminPlantsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignHeight="600" d:DesignWidth="900"
      Title="Админ: Каталог растений">

    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель -->
        <StackPanel Orientation="Horizontal" Margin="10" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Left">
            <ComboBox x:Name="ComboFilter" Width="160" Margin="5" Height="23" SelectionChanged="ComboFilter_SelectionChanged"/>
            <ComboBox x:Name="ComboSort" Width="160" Margin="5" Height="23" SelectionChanged="ComboSort_SelectionChanged">
                <ComboBoxItem Content="Название А-Я"/>
                <ComboBoxItem Content="Название Я-А"/>
                <ComboBoxItem Content="Цена ↑"/>
                <ComboBoxItem Content="Цена ↓"/>
            </ComboBox>
            <TextBox x:Name="TextSearch" Width="200" Height="23" Margin="5" TextChanged="TextSearch_TextChanged"/>

            <!-- Кнопка Заказы -->
            <StackPanel Orientation="Vertical" Margin="10,0,0,0" Cursor="Hand" VerticalAlignment="Center"
            MouseDown="GoToOrders_Click">
                <TextBlock Text="💼" FontSize="32" HorizontalAlignment="Center"/>
                <TextBlock Text="Заказы" FontSize="12" Foreground="Black" FontWeight="SemiBold"
               HorizontalAlignment="Center" Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Кнопка Скидки -->
            <StackPanel Orientation="Vertical" Margin="10,0,0,0" Cursor="Hand" MouseDown="GoToDiscounts_Click" VerticalAlignment="Center">
                <TextBlock Text="%" FontSize="32" HorizontalAlignment="Center"/>
                <TextBlock Text="Скидки" FontSize="12" Foreground="Black" FontWeight="SemiBold"
               HorizontalAlignment="Center" Margin="0,4,0,0"/>
            </StackPanel>
        </StackPanel>

        <!-- Список растений -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ItemsControl x:Name="ListPlants" Margin="20">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <!-- WrapPanel автоматически распределяет элементы по строкам -->
                        <WrapPanel IsItemsHost="True" Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="270" Height="auto" BorderBrush="#DDD" BorderThickness="1" Padding="10" Margin="20,0,10,20">
                            <StackPanel>
                                <!-- Фото -->
                                <Image Source="{Binding PhotoPath, FallbackValue=/Images/no-image.jpg}" Height="180" Width="250" Stretch="UniformToFill" />

                                <!-- Название -->
                                <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="Bold" Margin="0,5,0,0"/>

                                <!-- Описание -->
                                <TextBlock Text="{Binding Description}" FontSize="12" TextWrapping="Wrap" Margin="0,5,0,0"/>

                                <!-- Категория -->
                                <TextBlock Text="{Binding CategoryName}" FontStyle="Italic" Foreground="Gray" Margin="0,5,0,0"/>

                                <!-- Цена -->
                                <StackPanel Orientation="Vertical">
                                    <!-- Старая цена -->
                                    <TextBlock Text="{Binding Price, StringFormat=Цена: {0:N1} ₽}"
               FontSize="13" Foreground="Black" Margin="0,5,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Новая цена -->
                                    <TextBlock Text="{Binding DiscountedPrice, StringFormat=Новая цена: {0:N1} ₽}"
               FontSize="14" FontWeight="Bold" Foreground="Red" Margin="0,5,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Размер скидки -->
                                    <TextBlock Text="{Binding DiscountPercent, StringFormat='Скидка: {0} %'}"
               FontSize="12" FontStyle="Italic" Foreground="#FFA500" Margin="0,2,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Описание скидки -->
                                    <TextBlock Text="{Binding DiscountDescription}" 
               FontStyle="Italic" 
               Foreground="Gray" 
               FontSize="12" 
               Margin="0,2,0,0" 
               TextWrapping="Wrap">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                
                                <!-- Кнопки управления -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
                                    <Button Content="Редактировать" Background="LightBlue" Foreground="White" Padding="10,2"
                                            Click="EditPlant_Click" Tag="{Binding}" Margin="0,0,10,0"/>
                                    <Button Content="Удалить" Background="Red" Foreground="White" Padding="10,2"
                                            Click="DeletePlant_Click" Tag="{Binding}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Нижняя панель -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10" Grid.Row="2">
            <TextBlock x:Name="CountRecords" VerticalAlignment="Center" Margin="10,0"/>
            <Button x:Name="bCreatePlant" Content="Добавить растение" Margin="5" Click="bCreatePlant_Click"/>
        </StackPanel>
    </Grid>
</Page>