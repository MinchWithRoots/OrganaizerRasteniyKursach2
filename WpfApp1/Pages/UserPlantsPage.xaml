<Page
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="av"
    x:Class="WpfApp1.Pages.UserPlantsPage"
    Title="Пользователь: Каталог растений"
    av:DesignHeight="600"
    av:DesignWidth="900">

    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель -->
        <DockPanel Grid.Row="0" Margin="10" LastChildFill="False">
            <!-- Левая часть: фильтры и поиск -->
            <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center">
                <ComboBox x:Name="ComboFilter" Width="160" Margin="5" Height="23" SelectionChanged="ComboFilter_SelectionChanged"/>
                <ComboBox x:Name="ComboSort" Width="160" Margin="5" Height="23" SelectionChanged="ComboSort_SelectionChanged">
                    <ComboBoxItem Content="Название А-Я"/>
                    <ComboBoxItem Content="Название Я-А"/>
                    <ComboBoxItem Content="Цена ↑"/>
                    <ComboBoxItem Content="Цена ↓"/>
                </ComboBox>
                <TextBox x:Name="TextSearch" Width="200" Height="23" Margin="5" TextChanged="TextSearch_TextChanged"/>
            </StackPanel>

            <!-- Правая часть: корзина и заказы -->
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Center">
                <!-- Кнопка Корзина -->
                <StackPanel Orientation="Vertical" Margin="10,0" Cursor="Hand" VerticalAlignment="Center" MouseDown="GoToCart_Click">
                    <TextBlock Text="🛒" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="Корзина" FontSize="12" Foreground="Black" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Кнопка Заказы -->
                <StackPanel Orientation="Vertical" Margin="10,0" Cursor="Hand" VerticalAlignment="Center" MouseDown="GoToOrders_Click">
                    <TextBlock Text="📦" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="Мои заказы" FontSize="12" Foreground="Black" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>
            </StackPanel>
        </DockPanel>

        <!-- Список растений -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ItemsControl x:Name="ListPlants" Margin="20">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel IsItemsHost="True" Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="270" Height="Auto" BorderBrush="#DDD" BorderThickness="1" Padding="10" Margin="10">
                            <StackPanel>
                                <!-- Фото -->
                                <Image Source="{Binding PhotoPath}" Height="180" Width="250" Stretch="UniformToFill" />

                                <!-- Название -->
                                <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="Bold" Margin="0,5,0,0"/>

                                <!-- Описание -->
                                <TextBlock Text="{Binding Description}" FontSize="12" TextWrapping="Wrap" Margin="0,5,0,0"/>

                                <!-- Категория -->
                                <TextBlock Text="{Binding CategoryName}" FontStyle="Italic" Foreground="Gray" Margin="0,5,0,0"/>

                                <!-- Цена -->
                                <StackPanel Orientation="Vertical">
                                    <!-- Старая цена -->
                                    <TextBlock Text="{Binding Price, StringFormat=Цена: {0:N1} ₽}"
                                               FontSize="13" Foreground="Black" Margin="0,5,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Новая цена -->
                                    <TextBlock Text="{Binding DiscountedPrice, StringFormat=Новая цена: {0:N1} ₽}"
                                               FontSize="14" FontWeight="Bold" Foreground="Red" Margin="0,5,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Размер скидки -->
                                    <TextBlock Text="{Binding DiscountPercent, StringFormat='Скидка: {0} %'}"
                                               FontSize="12" FontStyle="Italic" Foreground="#FFA500" Margin="0,2,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!-- Описание скидки -->
                                    <TextBlock Text="{Binding DiscountDescription}" 
                                               FontStyle="Italic" 
                                               Foreground="Gray" 
                                               FontSize="12" 
                                               Margin="0,2,0,0" 
                                               TextWrapping="Wrap">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasActiveDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Кнопка "Добавить в корзину" -->
                                <Button Content="Добавить в корзину" 
                                        Background="Green" 
                                        Foreground="White" 
                                        Padding="10,5" 
                                        HorizontalAlignment="Center"
                                        Margin="0,10,0,0"
                                        Click="AddToCart_Click"
                                        Tag="{Binding}"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Нижняя панель -->
        <DockPanel Grid.Row="2" Margin="10" LastChildFill="False">
            <!-- Счетчик записей (слева) -->
            <TextBlock x:Name="CountRecords" 
                       DockPanel.Dock="Left" 
                       FontSize="14" 
                       Foreground="Black" 
                       FontWeight="Bold" 
                       Margin="10,0" VerticalAlignment="Bottom"/>

            <!-- Правая часть: мои растения и напоминания -->
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Center">
                <!-- Кнопка Мои растения -->
                <StackPanel Orientation="Vertical" Margin="10,0" Cursor="Hand" VerticalAlignment="Center" MouseDown="GoToMyPlants_Click">
                    <TextBlock Text="🌱" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="Мои растения" FontSize="12" Foreground="Black" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Кнопка Напоминания -->
                <StackPanel Orientation="Vertical" Margin="10,0" Cursor="Hand" VerticalAlignment="Center" MouseDown="GoToReminders_Click">
                    <TextBlock Text="🔔" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="Уведомления" FontSize="12" Foreground="Black" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>
            </StackPanel>
        </DockPanel>
    </Grid>
</Page>